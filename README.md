#Things the senior guy wishes junior guys knew.

Part of my day job is network security architect.  On occasion I get asked why our network has so many firewalls in it.  The answer to that starts with an observation: every network has a network security policy, written or not, acknowledged or not.  The most basic, and common, is that there is one firewall connecting to the ISP/Internet and everything behind it has the same level of importance from a security perspective.  That is the default network security policy, everything is equally accessible.  This is the network architecture many people think of when you say firewall and it's not adequate for anything commercial or government in the modern world. If you have some collection of on-premise corporate assets, possibly mingling freely with all manner of SaaS, some of which are way more problematic if they get breached or leaked than you want to deal with, this brain-dropping may be important to you, but you're not really the target audience of this piece.  This is specifically for the junior security practitioner asking why you need so many firewalls and is the answer he should (but won't) get.  I will warn in advance that I will ignore, hand-wave and otherwise brush past some basic network things.  There is no attempt to cover deep packet inspection, IDS/IPS and so many other bits of functionality that tend to be associated with firewalls.  This is about standard firewalls and the things they do that most not-security people never consider.  I am also not touching zero trust and related approaches, since this is specifically about firewalls.

Security is a complicated business and it's sometimes a challenge to provide confidentiality, integrity and availability in the face of external attacks and internal misadventure.  What you need is a way to keep developers from accidentally clobbering the HR database.  Also, you need to keep the laptop with horrible malware (probably from some click on some obvious phish) from doing anything horrible to anything of value.  We're not even going to talk about the assholes who break into networks for a million reasons.  This all has to happen against a backdrop of no budget.  

The most effective and efficient way to defend your network is to divide it into separate chunks, usually referred to as segmentation, and set an appropriate amount of security on each segment.  This allows you to focus time, effort and resources where it makes sense and hopefully provides value, aligning nicely with the foundation security idea of providing the correct security in the correct place at the correct time.  Done correctly it can also reduce exposure to lateral movement if you're ever breached, though this is not something to count on.

There are a few approaches to network segmentation, but the most common in my experience is with VLANS, I suspect because it's also a convenient solution to a number of other common networking problems (which I won't touch here).  In most cases, what you get is that each VLAN has its own subnet which is a convenient piece of a larger network.  Practically, that means you might have a network of 10.a.b.c/8 and VLAN 1 maps to subnet 10.1.e.f/16, VLAN 2 maps to subnet 10.2.e.h/16, etc. It is possible to do other things for mapping addresses to VLANS, but if you're not using convenient network/subnet boundaries your network architect is making work unnecessarily and not doing you any favours.

It's important to remember that VLANS and subnets are not the same things even though everybody pretends they are.  The really short version is that VLANS are a layer 2 thing, subnets live at layer 3.  For most networks most of the time, that's not an issue for the security folk and we can ignore it except when we can't.  Also, IPv6 can have a significant impact on how you approach VLANS (or not, you get choices).  I'm ignoring hybrid (that is combined layer 2/3 which is any switch that can properly handle VLANS) devices because they don't really simplify any of this.

Once you have your network segmented you need a way to allow some connections between segments and sometimes the outside world (our job would get so much simpler if we could drop that availability requirement).  Firewalls do that, and allow an actual network security policy/architecture built around your actual network needs instead of just accepting the default.  Specifically, firewalls control what devices in which segments are allowed to connect to what under what conditions by enforcing policy at the junctions.  You might have all the office and management staff on one VLAN and provide access to various corporate compute assets based on static DHCP address assignments and firewall permit rules.  Having all the machines providing an api (or similar functionality) go through a single firewall making monitoring much more straightforward is another use case I've seen.  As an aside, this might also allow some simplification.  Have everything with an API, internal or external visibility, go through a dedicated firewall.  The external stuff is directed in using NAT/PAT from the ISP/Internet firewall keeping it away from internal API endpoints, making all the APIs, otherwise divided as internal and external, visible from internal addresses at a single point in the network for access, management and monitoring yet still segregated as far as ingress traffic can see.

I understand a lot of people think a firewall is not much more than a router with a bunch of ports and complicated ACLs and they aren't completely wrong.  Firewalls do, however, provide some nice benefits.  The first, and most obvious, the job they do controlling connections between VLANS, is also what should get every security guy paying attention.  They are devices for managing network use and access policy, which can be worked out in advance, with management or whoever.  It's not obvious but this turns the security question of access to a resource into a business question.  It means the whiny guy that wants access to whatever has to get some level of management to sign off on putting a hole in the firewall for him and that decision can be based on a set of pre-agreed conditions.  It seems a minor change, but it's more important than at first seems to be the case.  Yes, the security guys still have to explain why everybody getting access to everything is not necessarily the best approach, but now you can get an agreed policy and business basis instead of just the security guys saying no.  

Yes, you'll still need at least some variety of risk analysis, mitigation approaches, costs, likely effectiveness, etc., and all the things that come with calling yourself a network security practitioner so you can guide management in developing a not-stupid policy.  Which leads to why this is so important.  There are way more people able to competently manage policy and compliance than there are those who can manage security for non-trivial networks.  You're more likely to find some people who can competently craft a policy based on guidance than you are a brilliant firewall admin.  Networking and network security are really hard.  Please don't believe otherwise, this is complicated shit and it requires mental energy and time investment to learn and more mental energy and time investment to keep up.  If, as a network security practitioner, you help the people who do policy put together a reasonable start, the future stops being just about pain.  Yes there will still be conflict between security and ease/convenience/cost.  That will never go away, but at least now the manager-class took part in deciding what was or was not a good idea on the network.  Equally importantly, when something horrible happens (and it will), it's more likely to be a failure of policy, rather than a failure of implementation or action on the part of the security professionals in the room.  You're much less likely to be fired for management's screw-ups than for your own but your mileage may vary.  Remember that technology fails can and do happen, so avoid victory laps.  

The other cool thing firewalls do is make capturing a lot of network data easy.  This is another of those things that is underappreciated by the more junior security folk.  The logs go to the SIEM, the analysts probably never see it and so what?  Well, first, if your rule set matches the agreed policy, and it should, you can see which rules are getting hits and which aren't (proper firewalls track hits for each rule) and adjust the policy or fix the rule set as might make sense.  Either way, this is the kind of review/improve approach that sometimes (almost never) leads to a bonus.  It certainly makes the policy and compliance folks happy.  It is also, sadly, something unattainable in most network security shops.  If you don't have a documented  (and coherent ) policy underlying the firewall rules you can't really tell if the firewalls are doing a good job, or even the expected job, because you have nothing to measure against.  When the folks in charge start asking questions about a significant security failure is not the time to rely on your creative writing skills to explain how great the firewalls are and why whatever happened shouldn't lead to you needing a new employer.

The firewall can also tell you if your policies make sense in terms of usage.  Do you have a policy of allowing everything from some "special" VLAN access to some other VLAN?  The firewall can tell you if there's only 1 endpoint on that VLAN and maybe a more focused rule is a better call for security.  I know this sounds trivial, but in large networks, it's the kind of thing that can happen over time and it does have an impact.  Firewalls also provide a convenient window into where traffic originates and where it goes that is occasionally appreciated by the network folks.  This is the kind of thing a network security practitioner can use to justify his paycheck.

If you work with (or are) someone who can develop software-based tools, you can go 1 step further and make compliance testing not unlike software integration testing.  It's quite possible to build a firewall  model of operation, feed it a ruleset validated against the policy requirements then test it with proposed flows.  This can then be automated making change management a joy.  You want a rule change?  Let's see what the policy test says we should do.  You can do something similar by testing flows against an actual firewall manually but this doesn't scale well and gets old really fast.  The first approach is a bit challenging for many (did I mention this is a complicated business?) and should not be attempted without a life-cycle plan (seriously, if the person that wrote it leaves, what happens when it breaks?). 

So, to answer the question at the beginning:  because firewalls simplify dividing a network into identifiable pieces and can then enforce policies related to the interactions of these various network pieces in a focused and efficient way.  How many firewalls should a network have?  That depends on the network segmentation which depends on what you're protecting and its risks, but the answer for any non-trivial network should always be greater than 1.  There are, of course, other opinions, this one is mine.
